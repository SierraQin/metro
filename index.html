<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg.zpd/0.0.12/snap.svg.zpd.js"></script>
<html>

<head>
    <title>北京市轨道交通线路配置图</title>
    <link rel="icon" href="https://metro-1252278458.cos.ap-beijing.myqcloud.com/img/sq4u_128.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://metro-1252278458.cos.ap-beijing.myqcloud.com/img/sq4u_128.ico" type="image/x-icon">
    <style>
        svg {
            position: fixed;
            top: 0;
            left: 0;
            height: device-height;
            width: device-width;
        }
        
        * {
            user-select: none;
        }
    </style>
</head>

<body>
    <div class="txt" style="position: fixed; right: 4px; bottom: 0px; z-index: 999999;">
        <!--img title="作者：SierraQin" src="https://metro-1252278458.cos.ap-beijing.myqcloud.com/img/sq4u_50.png"
            style="height: 240px; width: 240px;"></img-->
        <br />
        <button title="恢复初始位置及缩放比例" onclick="rst()" style="height: 60px; width: 240px; font-size: 24px;">重置缩放比例</button>
        <br />
        <button title="前往项目主页下载PDF文件" onclick="dpdf()" style="height: 60px; width: 240px; font-size: 24px;">下载PDF文件</button>
        <br />
        <button title="最新开发版配线图" onclick="rdpr()" style="height: 60px; width: 240px; font-size: 24px;">查看最新开发版</button>
        <br />
        <button title="前往Gitee提交Issue" onclick="gei()" style="height: 60px; width: 240px; font-size: 20px;">提交Issue反馈问题<br />(需登录Gitee账号)</button>
        <br />
        <button id="clg" title="查看更新内容" onclick="clg()" style="height: 60px; width: 240px; font-size: 20px;"></button>
        <br />
        <img title="本作品采用CC BY-SA 4.0协议授权" onclick="bysa()" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg" style="height: 84px; width: 240px;"></img>
    </div>
    <script>
        var dpdfUrl = "https://gitee.com/SierraQin/metro";
        var s = Snap();
        var applyZpd = function() {
            s.zpd({
                zoomScale: 1
            });
        };

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var json = JSON.parse(this.responseText);
                Snap.load("https://metro-1252278458.cos.ap-beijing.myqcloud.com/svg/MTR" + json.mtrVer + ".svg", function(f) {
                    s.append(f);
                    applyZpd();
                    s.panTo(-7150 + screen.availWidth / 2, -8950 + screen.availHeight / 2, 0, function() {
                        // s.zoomTo();
                    });
                });

                if (window.location.host.indexOf("qinxr.cn") > -1) {
                    dpdfUrl = "https://metro-1252278458.cos.ap-beijing.myqcloud.com/MTR/MTR" + json.mtrVer + ".pdf";
                }

                document.getElementById("clg").innerHTML = "版本：正式版" + json.mtrVer + "<br />日期：" + json.mtrDate;
            }
        };
        xhr.open("GET", "https://metro-1252278458.cos.ap-beijing.myqcloud.com/mpVars/mtr.json", true);
        xhr.send();



        function rst() {
            s.zoomTo(1, 0, null, function() {
                s.panTo(-7150 + screen.availWidth / 2, -8950 + screen.availHeight / 2, 0);
            });
        };

        function dpdf() {
            window.open(dpdfUrl);
        };

        function bysa() {
            window.open("http://creativecommons.org/licenses/by-sa/4.0/deed.zh");
        };

        function clg() {
            window.open("https://gitee.com/SierraQin/metro/blob/master/changeLog.md");
        };

        function rdpr() {
            var rdprUrl = window.location.href;

            if (rdprUrl.indexOf("index" > -1)) {
                rdprUrl = rdprUrl.slice(0, rdprUrl.indexOf("index"));
            }

            if (rdprUrl[rdprUrl.length - 1] != "/") {
                rdprUrl += "/";
            }

            window.location.href = rdprUrl + "prototype";
        };

        function gei() {
            window.open("https://gitee.com/SierraQin/metro/issues/new");
        };
    </script>
</body>

</html>